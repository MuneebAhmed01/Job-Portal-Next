// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/lib/prisma"
}

datasource db {
  provider = "postgresql"
}

// Employee model - for job seekers
model Employee {
  id         String   @id @default(cuid())
  name       String
  phone      String
  email      String   @unique
  password   String
  resumePath String?
  bio        String?
  createdAt  DateTime @default(now())

  applications JobApplication[] @relation("EmployeeApplications")
  savedJobs    SavedJob[]       @relation("EmployeeSavedJobs")

  @@map("employees")
}

// Employer model - for companies/recruiters
model Employer {
  id          String   @id @default(cuid())
  name        String
  phone       String
  companyName String
  email       String   @unique
  password    String
  bio         String?
  createdAt   DateTime @default(now())

  jobs Job[] @relation("EmployerJobs")

  @@map("employers")
}

model Job {
  id          String    @id @default(cuid())
  employerId  String
  title       String
  description String
  location    String
  salaryRange String
  type        JobType   @default(ONSITE)
  status      JobStatus @default(ACTIVE)
  createdAt   DateTime  @default(now())

  employer     Employer         @relation("EmployerJobs", fields: [employerId], references: [id], onDelete: Cascade)
  applications JobApplication[] @relation("JobApplications")
  savedBy      SavedJob[]       @relation("SavedJobs")

  @@map("jobs")
}

enum JobType {
  ONSITE
  REMOTE
  HYBRID
}

model JobApplication {
  id         String   @id @default(cuid())
  jobId      String
  employeeId String
  appliedAt  DateTime @default(now())

  job      Job      @relation("JobApplications", fields: [jobId], references: [id], onDelete: Cascade)
  employee Employee @relation("EmployeeApplications", fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([jobId, employeeId])
  @@map("job_applications")
}

model SavedJob {
  id         String   @id @default(cuid())
  jobId      String
  employeeId String
  savedAt    DateTime @default(now())

  job      Job      @relation("SavedJobs", fields: [jobId], references: [id], onDelete: Cascade)
  employee Employee @relation("EmployeeSavedJobs", fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([jobId, employeeId])
  @@map("saved_jobs")
}

model UserLog {
  id        String   @id @default(cuid())
  
  userId    String
  action    String
  message   String?
  createdAt DateTime @default(now())

  @@map("user_logs")
}

model EmployerLog {
  id         String   @id @default(cuid())
  employerId String
  action     String
  message    String?
  createdAt  DateTime @default(now())

  @@map("employer_logs")
}

enum JobStatus {
  ACTIVE
  CLOSED
  DRAFT
}
